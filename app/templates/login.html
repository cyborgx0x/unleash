{% extends "layout.html" %}
{% block title %}Login{% endblock %}
{% block layoutcenter %}


<script>
  window.fbAsyncInit = function () {
    FB.init({
      appId: '209400212009463',
      cookie: true,
      xfbml: true,
      version: 'v17.0'
    });

    FB.AppEvents.logPageView();

    FB.getLoginStatus(function (response) {
      if (response.status === 'connected') {
        
        let package = {
          token: response.authResponse.accessToken,
          expired: response.authResponse.data_access_expiration_time
        }
        axios.post("/authorized",package).then((response) => {
          if (response.status == 200) {
            console.log(response.data.message)
            location = "/"
          }
          else if (response.status == 201) {
            console.log(response.data.message)
            location = "/"
          }
          else {
            console.log(response.data.message)
            location = "/"
          }
        })
      }
      else {
        FB.login() 
      }
    });

  };
  function checkLoginState () {
    FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });
  }
  (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {
      return;
    }
    js = d.createElement(s);
    js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>


<div class="card" style="padding-left: 20px; padding-top:10px;padding-right:10px">
  <h1>Log In</h1>
  <fb:login-button 
  scope="public_profile,email"
  onlogin="checkLoginState();">
</fb:login-button>
  <form action="" method="post" novalidate>
    {{ form.hidden_tag() }}
    {{ form.username.label }}
    <div class="input-group mb-2">

      <span class="input-group-text">
        @
      </span>
      {{ form.username(size=32, class="form-control") }}
      {% for error in form.username.errors %}
      <span style="color:red;">[{{ error }}]</span>
      {% endfor %}
    </div>
    {{ form.password.label }}
    <div class="input-group mb-2">

      {{ form.password(size=32, class="form-control") }}
      {% for error in form.password.errors %}
      <span style="color:red;">[{{ error }}]</span>
      {% endfor %}
    </div>
    <p>
      {{ form.remember_me(class="form-check-input") }} {{ form.remember_me.label }}
    </p>
    <p>
      {{ form.submit(class="btn btn-primary") }}
    </p>
  </form>
  <p>
    New User?
    <a href="{{ url_for('register') }}">Đăng ký</a>
  </p>
</div>
{% endblock  %}