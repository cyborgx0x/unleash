{% extends "base.html" %}
{% block title %}{{ author.name}}: All fictions{% endblock %}
{% block style %} 
{{super()}}
<style>
    .fiction-zone{
        padding-left: 20px;
    }
</style>
{% endblock %}
{% block content%}

<div class="row justify-content-start">
    <div class="col-md-4">
        
        <div style="display:flex">
            <a type="button" class="btn dropdown" data-bs-toggle="dropdown" >
                ‚öô T√πy ch·ªçn
            </a>
            <div class="dropdown-menu dropdown-menu-demo dropdown-menu-arrow bg-dark text-white">
                <a href="{{url_for('edit_author', author_id=author.id)}}" class="dropdown-item">Ch·ªânh s·ª≠a t√°c gi·∫£ üî•</a> 
                <a href="#" class="dropdown-item">
                    X√°c nh·∫≠n s·ªü h·ªØu ‚úî
                </a>
            </div>
        </div>
        <div class="card" style="margin:5px">
            
            <div class="card-img-top">
                <img src="{% if author.img %}{{ author.img}}{% else %} http://localhost/upload/sample.jpg{% endif %}" alt="{{author.name}}">

            </div>
            <div class="card-body">
                <a href="/author/{{ author.name}}"><h3 class="card-title">{{ author.name}}</h3>
                </a>
                <p>S·ªë t√°c ph·∫©m ƒë∆∞·ª£c c·∫≠p nh·∫≠t: {{ author.fiction_count}}</p>
                <p>NƒÉm sinh: {{ author.birth_year}}</p>
                <a href={{ author.author_page}}> Author website</a>
            </div>
            <div>
                {% set value = "follow" %}
                {% set buttonContent = "Theo d√µi üíéüíéüíé" %}
                {% set idset =  author.follower | map(attribute='user_id') | list %}
                {% if current_user.id in idset %}
                {% set value= "followed" %}
                {% set buttonContent= "ƒê√£ theo d√µi üíÅ‚Äç‚ôÇÔ∏è" %}
                {% endif %}
                <span id="follower-count" class="badge bg-red" style="margin: 10px;"><strong>{{author.follower | count }} follower üßë</strong></span>
                <button href="#" type="button" class="btn" onclick="changeState(this)" value={{value}} name="{{author.id}}">{{buttonContent}}</button>
                <a href="#" type="button" class="card-btn">‚úâ nh·∫Øn tin </a>
            </div>
            <script>
                function changeState(context) {  
                    if (context.value=="follow") {
                        context.value="followed"
                        context.textContent = "ƒê√£ theo d√µi üíÅ‚Äç‚ôÇÔ∏è"
                        uploadData(context)
                    }
                    else {
                        context.value="follow"
                        context.textContent = "Theo d√µi üíéüíéüíé"
                        uploadData(context)
                    }
                }
                function uploadData(context) {
                    let data = {type:"author-follow", value:context.value, author:context.name}
                    console.log(data)
                    axios.post('/api/following/author/', {data:data}).then((res)=>{
                        console.log(res)
                        context.previousSibling.previousSibling.innerHTML = res.data
                    }).catch((err)=>{
                        context.textContent = "ƒê√£ c√≥ l·ªói x·∫£y ra"
                        context.disabled = true
                    })
                            
                }
            </script>
        </div>
        
        
    </div>
    
    <div class="col-md-8">

        <div class="card">
            <div class="card-header">T√°c gi·∫£: {{author.name}}</div>
            <div class="card-body" id="authorInformation" onload="loadAbout(this)">
                <div class="main-content">
                    üìÑ Ti·ªÉu s·ª≠ t√°c gi·∫£: 
                    {% set elements = author.cutText() %}
                        {% include "_content.html" %}

                </div>
            </div>

            <hr>
            <div class="fiction-zone">
                
                <h2 style="align-items: center;">
                    T√°c ph·∫©m theo th·ªùi gian
                </h2>
                {% for fiction in fictions %}
            
                <h3>NƒÉm xu·∫•t b·∫£n: {{fiction.publish_year}}</h3>
                <div class="row">
                    <div class="col-xl-4 col-sm-4">
                        <img src={{url_for("img_proxy", link=fiction.cover )}} alt={{fiction.name}}>
                    </div>
                    
                    <div class="col-xl-8 col-sm-8">
                        
                        <h3 class="card-title"><a href="/fiction/{{fiction.id}}">{{fiction.name}}</a></h3>
                        {% for chapter in fiction.chapter %}
                            {% include "_chapter_list.html" %}
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
</div>





{% endblock %}
